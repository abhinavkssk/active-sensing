\input{Header.tex}
\title{EN.530.603 Applied Optimal Control \\HW \#4 Solutions}
\graphicspath{{./figures/}}
\begin{document}
\maketitle

\begin{enumerate}

  %%%%%%%%%%%%%%%Question 1%%%%%%%%%%%%%%%%%%%%%%%%
  \item  Given minimization problem: 
    \begin{align*}
     &J = \frac{1}{2} x(1)^2 + \int_{0}^{1} \frac{1}{2}[x(t)u(t)]^2] dt\\
     & \dot x = xu \enskip x(0) = 1
    \end{align*}
   The components of HJB equation can be written as:
   \begin{align*}
    &L = \frac{1}{2} (xu)^2; \enskip f = xu; \enskip \phi = \frac{1}{2} (x(t_f))^2
   \end{align*}
   The minimum control is obtained as:
   \begin{align*}
    &u^* = argmin( \frac{1}{2} x^2 u^2 + \nabla_x V^T (xu))\\
    &\Rightarrow u^* = -\frac{1}{x} (\nabla_x V)\\
    &\mbox{Hamilton Jacobi Bellman(HJB) Equation :}\\
    &\partial_t V = \frac{1}{2} (\nabla_x V)^2\\
    & V(x,t_f) = \frac{1}{2}x^2
   \end{align*}
   Assume Value function to be of the form: $V(x,t) = \frac{1}{2} P(t) x^2$. Then reduced form of HJB equation is given as:
   \begin{align*}
    &\frac{1}{2} \dot P x^2  = \frac{1}{2} (Px)^2\\
    &\mbox{This is valid for any x so }\\
    &\dot P = P^2\\
    &P(t_f) = 1\\
    &\mbox{Optimal Control Law: }\\
    &u^* = (-1/x)(Px) = -P(t)
   \end{align*}
   This can be further solved to show that:
   \begin{align*}
    u(t) = -P(t) = \frac{1}{t-2}
   \end{align*}

   Note: The more general form: $V = \frac{1}{2}Px^2 + bx + c$  can be assumed but you need to show that b(t) = 0 and c(t) = 0 for all $t\in(t_0,t_f)$.
  %%%%%%%%%%%%%%%Question 2%%%%%%%%%%%%%%%%%%%%%%%%
  \item 
  \begin{enumerate}
   \item For the given LQR problem, the associated components in HJB equation are as follows:
  \begin{align*}
   &L = \frac{1}{2}(x^T Q x + u^T R u); \enskip \phi = \frac{1}{2}x(t_f)^T P_f x(t_f);\enskip f(x,u) = Ax+Bu+w
  \end{align*}
  The minimum control is obtained as:
  \begin{align*}
   &u^* = argmin ( \frac{1}{2} (x^T Q x + u^T R u ) + \nabla_x V^T (Ax+Bu+w))\\
   &u^* = -R^{-1}B^T\nabla_x V\\
   &\mbox{Reduced form of HJB equation: }\\
   &-\partial_t V = \frac{1}{2}(x^T Q x  - \nabla_x V^T B R^{-1} B^T \nabla_x v) + \nabla_x V^T (A x + w)
  \end{align*}
  Now we substitute the Value function to be of the form: $V(x,t) = \frac{1}{2} x^T P x + b^Tx + c$:
  \begin{align*}
   &\partial_t V = \frac{1}{2} \dot P x^2 + \dot b x + \dot c\\
   &\nabla_x V = Px + b\\
   &\Rightarrow \frac{1}{2}x^T(-\dot P)x + (-\dot b^T) x - \dot c = \frac{1}{2} x^T Q x - \frac{1}{2} (Px+b)^T (BR^{-1}B^T)(Px+b) + (Px+b)^T(Ax+w)\\
   &\Rightarrow x^T \left[ \frac{1}{2} (\dot P + Q - P B R^{-1} B^T P + 2P^T A)\right] x + \left[{\dot b}^T - b^T(BR^{-1}B^T)P+b^TA + w^TP\right]x \\
   & \quad + \left[\dot c - \frac{1}{2} b^T BR^{-1}B^T b + b^T w\right] = 0\\
   &P(t_f) = P_f \enskip b(t_f)= \mathbf{0} \enskip c(t_f) = 0
  \end{align*}
  Since the HJB equation is valid for all x(t), we can find the differential equations for P(t), b(t), c(t). To make P symmetric, we replace $2P^T A$ with $(PA + A^TP)$.
  \begin{align*}
   \dot P &= -Q + P(B R^{-1} B^T)P - (P^T A + A^T P); \enskip P(t_f) = P_f\\
   \dot b &= \left(P(BR^{-1}B^T) - A^T\right) b - Pw; \enskip b(t_f) = \mathbf{0}\\
   \dot c &= \frac{1}{2} b^T(B R^{-1} B^T) b - b^T w; \enskip c(t_f) = 0
  \end{align*}
  The optimal control law is given as:
  \begin{align*}
   &u^* = -R^{-1}B^T(Px+b) = K(t) x + k(t)\\
   &K(t) = -R^{-1}B^TP(t); \enskip k(t) = -R^{-1}B^Tb(t)
  \end{align*}

  \item For the discrete equivalent of the above problem, the associated components in a Bellman equation are as follows:
  \begin{align*}
   &L_i(x,u) = \frac{1}{2}(x^T Q_i x + u^T R_i u); \enskip f_i(x,u) = A_i x + B_i u + w_i\\
   &\mbox{Bellman Equation: }\\
   &V_i = min_u \left[L_i + V_{i+1}(f_i(x,u))\right]\\
   &V_N = \frac{1}{2} x^T P_f x
  \end{align*}
  We substitute the form of $V_i$ as $V_i(x) = \frac{1}{2} x^TP_i x + b_i x + c_i$. Then the optimal control is found as:
  \begin{align*}
   &u^*_i = argmin\{\frac{1}{2}(x^T Q_i x + u^T R_i u) + \frac{1}{2} (A_i x + B_i u + w_i)^T P_{i+1} (A_i x + B_i u + w_i) \\
   &\quad + b_{i+1}^T (A_i x + B_i u + w_i) + c_{i+1}\}\\
   &u^*_i = -M\left(B_i^T P_{i+1}(A_i x + w_i) + B_i^T b_{i+1}\right)\\
   &M = \left[R_i + B_i^TP_{i+1}B_i\right]^{-1}
  \end{align*}
  Now we first substitute the form of $V_i$ in bellman equation and replace u with $u^*$:
  \begin{align*}
   &V_i = \frac{1}{2}(x^T Q_i x + {u^*}^T R_i {u^*}) + \frac{1}{2} (A_i x + B_i u^* + w_i)^T P_{i+1} (A_i x + B_i u^* + w_i) \\
   &\quad + b_{i+1}^T (A_i x + B_i u^* + w_i) + c_{i+1}\\
   &V_i = \frac{1}{2}x^T\left(Q_i + A_i^T P_{i+1}A_i\right)x + \frac{1}{2}{u^*}^T M^{-1} u^* + \left[(A_i x + w_i)^T P_{i+1} B_i + b_{i+1}^T B_i\right] u^* \\
   &\quad  + (w_i^T P_{i+1}A_i + b_{i+1}^T A_i) x + \frac{1}{2}w_i^T P_{i+1} w_i + b_{i+1}^T w_i + c_{i+1}\\
   &V_i = \frac{1}{2}x^T\left(Q_i + A_i^T P_{i+1}A_i\right)x + \frac{1}{2}{u^*}^T M^{-1} u^* -u^* M^{-1} u^* \\
   &\quad  + (w_i^T P_{i+1}A_i + b_{i+1}^T A_i) x + \frac{1}{2}w_i^T P_{i+1} w_i + b_{i+1}^T w_i + c_{i+1}\\
   &V_i = \frac{1}{2}x^T\left(Q_i + A_i^T P_{i+1}A_i\right)x \\
   &\quad - \frac{1}{2} \left(B_i^T P_{i+1}A_i x + B_i^T (P_{i+1} w_i + b_{i+1})\right)^T M \left(B_i^T P_{i+1}A_i x + B_i^T(P_{i+1} w_i + b_{i+1})\right)\\
   &\quad  + (w_i^T P_{i+1}A_i + b_{i+1}^T A_i) x + \frac{1}{2}w_i^T P_{i+1} w_i + b_{i+1}^T w_i + c_{i+1}\\
   &V_i = \frac{1}{2}x^T\left[Q_i + A_i^T (P_{i+1} - P_{i+1}^TB_i M B_i^T P_{i+1})A_i)\right]x \\
   &\quad  + \left[ (w_i^T P_{i+1} + b_{i+1}^T ) (A_i - B_i M B_i^T P_{i+1} A_i) \right]x\\
   &\quad + \frac{1}{2}w_i^T P_{i+1} w_i - \frac{1}{2} \left( B_i^T (P_{i+1} w_i + b_{i+1})\right)^T M \left( B_i^T(P_{i+1} w_i + b_{i+1})\right)+ b_{i+1}^T w_i + c_{i+1}\\
  \end{align*}
   Thus the corresponding difference equations for $P_i, b_i, c_i $ can be found as:
   \begin{align*}
    P_i &= Q_i + A_i^T (P_{i+1} - P_{i+1}^TB_i M B_i^T P_{i+1})A_i\\
    b_i &=  (w_i^T P_{i+1} + b_{i+1}^T ) (A_i - B_i M B_i^T P_{i+1} A_i)\\
    c_i &= \frac{1}{2}w_i^T P_{i+1} w_i - \frac{1}{2} \left( B_i^T (P_{i+1} w_i + b_{i+1})\right)^T M \left( B_i^T(P_{i+1} w_i + b_{i+1})\right)+ b_{i+1}^T w_i + c_{i+1}\\
    M &= \left[R_i + B_i^TP_{i+1}B_i\right]^{-1}
   \end{align*}
    %\quad&= \frac{1}{2}w_i^T \left(P_{i+1} - P_{i+1}^T B_i M B_i^T P_{i+1}\right) w_i - \frac{1}{2} b_{i+1}^T B_i M  B_i^T b_{i+1}+ (b_{i+1}^T(I - B_i M B_i^T P_{i+1})) w_i + c_{i+1}
   The boundary conditions are $P_N = P_f, b_N = 0, c_N = 0$. The optimal control law is given as:
   \begin{align*}
   u^*_i &= K_i x_i + k_i\\
   K_i &= -\left[R_i + B_i^TP_{i+1}B_i\right]^{-1} B_i^T P_{i+1}A_i \\
   k_i &= -\left[R_i + B_i^TP_{i+1}B_i\right]^{-1} B_i^T (b_{i+1} + P_{i+1}w_i)
   \end{align*}
   [Note: If you write the differential equations for $P_i, b_i, c_i$ in terms of $K_i, k_i$, they turn out to be:
   \begin{align*}
    P_i &= Q_i + K_i^T R_i K_i + (A_i + B_i K_i)^T P_{i+1} (A_i + B_i K_i)\\
    b_i &= (w_i^T P_{i+1} + b_{i+1}^T)(A_i + B_i K_i)\\
    c_i &= \frac{1}{2}w_i^T P_{i+1} w_i - \frac{1}{2} k_i^T (R_i + B_i^T P_{i+1} B_i) k_i+ b_{i+1}^T w_i + c_{i+1}\\
   \end{align*}]






  \end{enumerate}


   
\end{enumerate} 
\vfill
\begin{acknowledgements}
I hereby declare that I have not discussed this homework with anyone. The solutions written here are
my own work and  from lecture notes and sample code provided by the professor. Any 
external references are mentioned in the text.
\flushright Gowtham Garimella
\end{acknowledgements}




\end{document}
