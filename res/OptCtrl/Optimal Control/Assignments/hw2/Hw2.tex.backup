\input{Header.tex}
\title{EN.530.603 Applied Optimal Control \\HW \#2 Solutions}
\graphicspath{{./figures/}}
\begin{document}
\maketitle

\begin{enumerate}

  %%%%%%%%%%%%%%%Question 1%%%%%%%%%%%%%%%%%%%%%%%%
  \item To find the curve $x^*$ which minimizes J(x) passing throught 0 and 4.
  \begin{equation}
   J(x) = \int_0^1 \left[ \frac{1}{2} {\dot x}^2(t) + 3 x(t) \dot x(t) +2x^2(t) + 3x(t)\right]dt
  \end{equation}
  From Euler-Lagrange equations:
  \begin{align*}
   &&J(x) = \int_0^1 g(x,\dot x,t) dt \\
    &\text{Necessary Conditions}& \\
  &&g_x - \frac{d}{dt} g_{\dot x}  = (3 \dot x + 4x + 4) - \frac{d}{dt}(\dot x + 3x) = 0\\
   &&\Rightarrow \ddot x = 4x + 3 \\ 
   &\text{Homogenous solution:}&\\
   &&\ddot x = 4x \Rightarrow x(t) = \lambda_1 e^{2t} + \lambda_2 e^{-2t} \quad \lambda_1 , \lambda_2 \in \mathbf{R} \\
   &\text{Non Homogenous solution:}&\\
   &&x(t) = -3/4 \Rightarrow \ddot x = 0 = 4 ( -3/4) +3\\
   &\text{Combined Solution:}&\\
   && x(t) =  \lambda_1 e^{2t} + \lambda_2 e^{-2t} - \frac{3}{4} \\
   &\text{Boundary Conditions:}& \\
   &&x(1) = 4 \quad \& \quad x(0) = x0\\
   &&\Rightarrow \lambda_1 + \lambda_2 = x0 + 3/4\\
   &&\Rightarrow \lambda_1 e^2 + \lambda_2 e^{-2} = 19/4\\
   && \Rightarrow \lambda_1 = ajflak \quad \lambda_2 = alfjalf \\ 
  &\text{Final Solution}&\\
  \end{align*}
  %%%%%%%%%%%%%%%Question 2%%%%%%%%%%%%%%%%%%%%%%%%
  \item To find extremals for 
  \begin{equation}
    J(x) = \int_0^{t_f} [{\dot{x_1}}^2(t) + {\dot{x_2}}^2(t) + 3 x_1(t) x_2(t) ] dt
  \end{equation}
  Using necessary conditions on the trajectory the Euler-Lagrange equations give the extremal trajectory as:
  \begin{align*}
  g_x - \frac{d}{dt} g_{\dot x}  &= \left[ 3 x_2 \quad 3 x_1\right] - \frac{d}{dt} \left[ 2 \dot{x_1}\quad 2\dot{x_2}\right] = 0\\
  \Rightarrow 2 \ddot{x_1} &= 3 x_2 \quad \& \quad 2 \ddot{x_2} = 3 x_1 \\
  \Rightarrow x_1^{(4)} &= \frac{3}{2} \ddot{x_2} = \frac{9}{4} x_1 \\
  \Rightarrow x_1(t) &= \lambda_1 sinh(\omega t) + \lambda_2 sin(\omega t) + \lambda_3 cosh(\omega t) + \lambda_4 cos(\omega t) \quad \omega = \sqrt{3/2};\\
  \Rightarrow x_2(t) &= \frac{2}{3} \ddot{x_1} = \lambda_1 sinh(\omega t) - \lambda_2 sin(\omega t) + \lambda_3 sinh(\omega t) - \lambda_4 sin(\omega t) \enskip \lambda_{1,2,3,4} \in \mathbf{R}\\
  \end{align*}
  Given $x_1(0) = 0 \enskip x_2(0) = 0$ implies that:
  \begin{equation*}
   \lambda_3 + \lambda_4 = 0 \enskip \& \enskip \lambda_3 - \lambda_4 = 0
  \end{equation*}
  which gives $\lambda_3 = \lambda_4 = 0$.
  
  \begin{align}
  \Rightarrow x_1(t) &= \lambda_1 sinh(\omega t) + \lambda_2 sin(\omega t) \\
  \Rightarrow x_2(t) &= \frac{2}{3} \ddot{x_1} = \lambda_1 sinh(\omega t) - \lambda_2 sin(\omega t) \label{eqn:2.bxt} 
  \end{align}

  \begin{enumerate}
   \item Given the boundary conditions we evaluate the unknowns $\lambda_1$ and $\lambda_2$ :
   \begin{align*}
    &\text{If} \enskip t_f = 1 \text{ and } x_2(t_f) = 1 \\
    &\text{then} \enskip \lambda_1 sinh(\omega) - \lambda_2 sin(\omega) = 1\\
    &\text{If} \enskip x_1(t_f) \text{ is free } \\
    &\text{then} \enskip g_{\dot x} (1) |_{t_f} = 0 \\
    &\Rightarrow \enskip 2 \dot{x_1}(t) |_{t = 1} = 0\\
    &\Rightarrow \enskip \lambda_1 cosh(\omega) + \lambda_2 cos(\omega) = 0\\
    &\Rightarrow \enskip
			  \begin{bmatrix}
			    sinh(\omega) & -sin(\omega)\\
			    cosh(\omega) & cos(\omega) \\
			  \end{bmatrix} 
			  \begin{bmatrix}
                          \lambda_1 \\
			  \lambda_2 \\
                         \end{bmatrix} = 
			 \begin{bmatrix}
			  1 \\
			  0\\
			 \end{bmatrix}\\
    &\Rightarrow 	  \begin{bmatrix}
                          \lambda_1 \\
			  \lambda_2 \\
			 \end{bmatrix} = \frac{1}{\alpha} 
			 \begin{bmatrix}
			  cos(\omega)\\
			  -cosh(\omega)\\
			 \end{bmatrix}\\
			 &\text{where} \enskip \alpha = cos(\omega) sinh(\omega) +cosh(\omega) sin(\omega) \\
   \end{align*}
   This solves the optimization problem for the given conditions completely as 
   \begin{align*}
    x_1(t) &= \frac{1}{\alpha} (cos(\omega) sinh(\omega t) -cosh(\omega) sin(\omega t))\\
    x_2(t) &= \frac{1}{\alpha} (cos(\omega) sinh(\omega t) + cosh(\omega) sin(\omega t))\\
    \omega &= sqrt(3/2) \enskip \& \enskip \alpha = cos(\omega) sinh(\omega) +cosh(\omega) sin(\omega) \\
   \end{align*}
   
   \item Given $t_f$ is free but the final position should lie on the surface:
   \begin{equation*}
   \psi(x(t),t) = x_1(t) + 3 x_2(t) + 5 t - 15 = 0
   \end{equation*}
   With this boundary condition, the optimization problem is modified as 
   \begin{align*}
    J^{\prime} (x) &= \nu (\psi(x(t_f), t_f)) + \int_0^{t_f} g(x,\dot x, t) dt\\
    g(x,\dot x, t) &= {\dot{x_1}}^2(t) + {\dot{x_2}}^2(t) + 3 x_1(t) x_2(t) 
   \end{align*}
   which provides the necessary boundary conditions as:
   \begin{align*}
   g_{\dot x} (t_f) + \nu (\psi_x(t_f)) &= 0 \\
   g(t_f) - g_{\dot x}(t_f) \dot x(t_f) + \nu (\psi_t(t_f)) &= 0 \\
   \psi(x(t_f),t_f) &= 0\\
   \end{align*}
   We need to solve for the unknowns $t_f, \lambda_1, \lambda_2, \nu$ with the conditions as described below. For brevity of notation, we denote $x_1(t_f) = x_{1f}$ etc
   \begin{align*}
   g_{\dot x} (t_f) + \nu (\psi_x(t_f)) &= 0 \\
   \Rightarrow 2 \begin{bmatrix}
               \dot x_{1f} & \dot x_{2f}
               \end{bmatrix} + \nu 
	       \begin{bmatrix}
	        1 & 3 
	       \end{bmatrix} &= 0 \\
    \Rightarrow \dot{x}(t_f) = \frac{-\nu}{2} \theta \enskip \text{where } \theta &= [1 \enskip 3]^{T}\\
    \Rightarrow \dot x(t_f) = \omega \begin{bmatrix}
                cosh(\omega t_f) & cos(\omega t_f) \\
		cosh(\omega t_f) & - cos(\omega t_f) \\
                \end{bmatrix} 
		\begin{bmatrix}
		 \lambda_1\\
		 \lambda_2 \\
		\end{bmatrix} &= -\frac{\nu}{2} 
		\begin{bmatrix}
		 1 \\
		3 
		\end{bmatrix} \quad \text{From Eqn(\ref{eqn:2.bxt})}\\
	\Rightarrow 
		\begin{bmatrix}
		 \lambda_1\\
		 \lambda_2 \\
		 \end{bmatrix} &= \frac{\nu}{2 \omega}
		 \begin{bmatrix}
		  -2 sech(\omega t_f)\\
		  sec(\omega t_f) \\
		 \end{bmatrix}\\
	\Rightarrow x(t_f) = 
			  \begin{bmatrix}
			    sinh(\omega) & -sin(\omega)\\
			    cosh(\omega) & cos(\omega) \\
			  \end{bmatrix} 
			  \begin{bmatrix}
                          \lambda_1 \\
			  \lambda_2 \\
                         \end{bmatrix} &=  \frac{\nu}{2 \omega}
			 \begin{bmatrix}
			  -2tanh(\omega t_f) + tan(\omega t_f)\\
			  -2tanh(\omega t_f) - tan(\omega t_f)\\
			 \end{bmatrix}
    \end{align*}
    Now using the above conditions, we solve for $\nu$ in terms of $t_f$ using the second boundary condition:
   %\Rightarrow g(t_f) = \dot{x}(t_f)^{T} \dot{x}(t_f)+ 3 x_{1f} x_{2f}  =\frac{\nu}{4}\theta^{T} \theta + 3 x_{1f} x_{2f}  &= \frac{5}{2}\nu^2 + 3 x_{1f} x_{2f}\\
    \begin{align*}
   g(t_f) - g_{\dot x}(t_f) \dot x(t_f) + \nu (\psi_x(t_f)) &= 0 \\
   \Rightarrow \dot{x}(t_f)^{T} \dot{x}(t_f)+ 3 x_{1f} x_{2f} - 2 \dot{x}(t_f)^{T} \dot{x}(t_f) + 5\nu &= 0\\
   \Rightarrow -\frac{5}{2}\nu^2 + 3 x_{1f} x_{2f} + 5\nu &= 0\\
   \Rightarrow -\frac{5}{2}\nu^2 + 5\nu + \frac{ \nu^2}{2} (4 tanh^2(\omega t_f) - tan^2(\omega t_f)) &= 0\\
   \nu \left[ 4 tanh^2(\omega t_f) - tan^2(\omega t_f) -5 \right] &= -10\quad \text{Since } \nu \neq 0 \\
   \end{align*}
   Now we use the third condition which requires the final point to be on the surface to find the final time $t_f$ which provides all the required variables:
   \begin{align*}
    \theta^{T} x(t_f) + 5t_f - 15 &= 0\\
    \Rightarrow \frac{\nu}{2 \omega} \theta^{T} 
    \begin{bmatrix}
    -2tanh(\omega t_f) + tan(\omega t_f)\\
    -2tanh(\omega t_f) - tan(\omega t_f)\\
  \end{bmatrix} + 5t_f - 15 &= 0\\ 
  \Rightarrow \frac{\nu}{2 \omega} (-8 tanh(\omega t_f) -2 tan(\omega t_f) ) + 5t_f - 15 &= 0\\
\end{align*}
The above equation is solved in MATLAB to obtain the value of $t_f$ as 3.6488. This gives the corresponding values as:
\begin{align*}
 \begin{bmatrix}
  \lambda_1 \\
  \lambda_2 \\
 \end{bmatrix} &= 
 \begin{bmatrix}
  -0.0093 \\
  -0.8383 \\
 \end{bmatrix}\\
 x_1(t) &= \lambda_1 sinh(\omega t) + \lambda_2 sin(\omega t) \\
 x_2(t) &= \lambda_1 sinh(\omega t) - \lambda_2 sin(\omega t) \\
\end{align*}

Check solution: 


  \end{enumerate}
  \item Given a function $\eta(t) \in \mathbf{C}^2$ (twice continous) defined on $\{t_0, t_f\}$ such that $\eta(t_0) = \eta(t_f) = 0$. We need to derive the Euler-Lagrange necessary conditions for fixed boundary conditions using the following evaluation form:
  \begin{align*}
   &J(x) = \int_{t_0}^{t_f} g(x(t), \dot x(t), t) dt \\
   &\left.\frac{d J(x^* + \epsilon \eta) }{d \epsilon} \right|_{\epsilon = 0} = 0 \\[5pt]
   &\Rightarrow \int_{t_0}^{t_f} (\left.\frac{d g(x^* + \epsilon \eta, {\dot x}^* + \epsilon \dot \eta)}{d \epsilon}\right|_{\epsilon = 0} dt = 0\\
   &\Rightarrow \frac{dg(x^* + \epsilon \eta,{\dot x}^* + \epsilon \dot \eta)}{d \epsilon} = \frac{\partial g}{\partial (x^* + \epsilon \eta)} \frac{d(x^* + \epsilon \eta)}{d\epsilon} + \frac{\partial g}{\partial (\dot x^* + \epsilon \dot \eta)} \frac{d(\dot x + \epsilon \dot \eta)}{d\epsilon}\\
   &\Rightarrow  \left. \frac{dg(x^* + \epsilon \eta,{\dot x}^* + \epsilon \dot \eta)}{d \epsilon}\right|_{\epsilon = 0} = \frac{\partial g}{\partial x^* } \eta + \frac{\partial g}{\partial \dot x^*} \dot \eta\\
   &\Rightarrow \int_{t_0}^{t_f} \left( \frac{\partial g}{\partial x^*} \eta  + \frac{\partial g}{\partial \dot x^*} \dot \eta \right) dt = 0\\
   &\Rightarrow \int_{t_0}^{t_f} \frac{\partial g}{\partial x^*} \eta(t) dt +\left. \frac{\partial g}{\partial \dot x^*} \eta(t)\right|_{t_0}^{t_f} - \int_{t_0}^{t_f} \frac{d}{dt} \left( \frac{\partial g}{\partial \dot x^*} \right) \eta (t) dt = 0 \\
   &\Rightarrow \int_{t_0}^{t_f} \left[ \frac{\partial g}{\partial x^*} - \frac{d}{dt} \left( \frac{\partial g}{\partial \dot x^*} \right)\right] \eta (t) dt = 0 \quad \text{Since } \eta(t_0) = \eta (t_f) = 0\\
  \end{align*}
  Since $\eta(t)$ is arbitrary function except for the endpoints, the above function will be zero only if the premultiplier to $\eta$ is zero over the trajectory between $t_0 $ and $t_f$. This gives the Euler-Lagrange equations as:
  \begin{equation*}
  \Rightarrow  \frac{\partial g}{\partial x} - \frac{d}{dt} \left( \frac{\partial g}{\partial \dot x} \right) = 0 \quad \forall x(t) = x^*(t) \text{ or the trajectory is optimal} 
  \end{equation*}
  %%%%%%%%%%%%%%%%Question 4%%%%%%%%%%%%%%%%%
  \item Given optimization problem :
  \begin{align*}
   \dot x &= -ax + bu \quad x(t_0) \text{ given}\\
   J  &= \frac{1}{2} c \left[ x(t_f) \right]^2 + \frac{1}{2} \int_{t_0}^{t_f} \left[ u(t) \right]^2 dt
  \end{align*}
  Equating the relevant parts of this problem to the general optimization problem we get the following:
  \begin{align*}
   &J_a = \phi(x(t_f),t_f) + \int_{t_0}^{t_f}\left( H(x(t),u(t),\lambda, t), -\lambda^T \dot x\right) dt \quad \text{(General optimization problem)}\\
   &\phi(x(t_f),t_f) =  \frac{1}{2} c \left[ x(t_f) \right]^2 \\
   &H(x(t),u(t),\lambda, t) = \frac{1}{2} \left[ u(t) \right]^2 + \lambda(-ax + bu) \\
  \end{align*}
  The necessary conditions for optimal control is :
  \begin{align*}
   H_u &= u + \lambda b = 0 \\
   \Rightarrow u &= -\lambda b\\
   \dot \lambda &= - \partial_x H = a \lambda \\
   \Rightarrow \lambda &= m e^{at}\\
   \Rightarrow u &= -m b e^{at}\\
  \end{align*}
  With this input we solve the dynamics of the system as follows:
  \begin{align*}
   \dot x &= -ax + b(-m b e^{at}) \\
   \Rightarrow x(t) &= e^{-a(t-t_0)} x(t_0) + \int_{t_0}^{t} e^{-a(t-\tau)} b \left( -m e^{a \tau } b \right) d\tau\\
   \Rightarrow x(t) &= e^{-a(t-t_0)} x(t_0) - \frac{m b^2 e^{-at}}{2a} \left[ e^{2at} - e^{2at_0}\right]\\
  \end{align*}
  Now we apply the boundary condition for $\lambda$ to get the value of m :
  \begin{align*}
   \lambda(t_f) &= \left. \partial_x \phi(x,t) \right|_{t=t_f} \\
   \Rightarrow \lambda(t_f) &= c x(t_f) = c \left[e^{-a(t_f-t_0)} x(t_0) - \frac{m b^2 e^{-at_f}}{2a} \left( e^{2at_f} - e^{2at_0}\right) \right]\\
   \Rightarrow m e^{t_f} &= c e^{-a(t_f - t_0)} - m \{ \frac{cb^2 e^{-at_f}}{2a} \left(e^{2at_f} - e^{2at_0}\right)a\}
  \end{align*}









  

\end{enumerate} 
\begin{acknowledgements}
I hereby declare that I have not discussed this homework with anyone. The solutions written here are my own work and  from lecture notes and sample code provided by the professor. 
\flushright Gowtham Garimella
\end{acknowledgements}




\end{document}
